## Q1

ブラウザに情報を保持させる仕組みがクッキーです。ブラウザはリクエストヘッダーにクッキーの情報を設定し、サーバーへリクエストを送信します。  
サーバーは送られてきたクッキーの情報を参照し処理をします。クッキーの情報をサーバーからクライアントにレスポンスする場合にレスポンスヘッダーとして `Set-cookie` を利用します。

仮にブラウザの設定でクッキーを利用しない設定にした場合、ログインが必要なサイトでログインした後に再びログインページに遷移した場合にはログイン後のページではなく、ログインフォームの画面が表示されます。これはクッキーにログイン情報（セッション ID）を保持していないため、ログイン情報が引き継がれないためです。

クッキーは同じオリジン、もしくはサブドメインを含むホストに送信されるため。  
クッキーは Domain 属性を持ち、Domain 属性にクッキーを受信することができるホストを指定することができます。Domain 属性を省略した場合は同じオリジンに送信し、サブドメインは除外します。  
一方、Domain 属性を指定した場合は、サブドメインを含むホストにも送信します。

## Q2

この場合は`cross-site`になるので、場合によっては送信されない。  
Samesite 属性に`LAX`を指定した場合は、`GET`メソッド場合のみクロスサイトでもクッキーを送信します。

## Q3

この場合は `cross-origin` になるので、場合によっては送信されない。  
Samesite 属性に`LAX`を指定した場合は、`GET`メソッド場合のみクロスオリジンでもクッキーを送信します。

## Q4

クッキーの Domain 属性を設定していない場合は、サブドメインにはクッキーを送信しません。

## Q5

Domain 属性を指定した場合は、サブドメインを含むホストにも送信します。

## Q6

クッキーの`HttpOnly属性`を有効にすることで JavaScript からクッキーを参照することが出来なくなります。

## Q7

クッキーの`Secure属性`を有効にすることで HTTPS の接続時のみクッキーを送信します。

## Q8

`Expires`を設定した場合は設定した日時までクッキーの情報を保持します。`Max-Age`は有効期限を秒で指定します。  
両方を設定した場合は`Max-Age`が優先されます。

## Q9

`SameSite属性`には以下の属性があります。

- Lax
  - クロスサイトに対して GET メソッドではクッキーを含めるが、POST、画像読み込み、XHR、iframe ではクッキーを含めない
- Strict
  - クロスサイトに対して Cookie をヘッダーに含めない。銀行のサイトなどが Strict に設定されていることがある（らしい）
- None
  - クロスサイトに対してクッキーをヘッダーに含める

## Q10

クッキーの用途としては以下があります。

> Cookie は主に、以下の 3 つの用途で使用されます。

> セッション管理
> ログイン、ショッピングカート、ゲームのスコア、またはその他のサーバーが覚えておくべきもの

> パーソナライゼーション
> ユーザー設定、テーマ、その他の設定

> トラッキング
> ユーザーの行動の記録及び分析

一方、クッキーに保持しない方がよい情報としては以下があります。

- 個人情報（指名、メールアドレス、住所）
- クレジットカードの情報（CVV など）
- ユーザーの状態（振る舞い）を管理している情報 ※1

※1  
例えばユーザーが一度だけ応募できるキャンペーンサイトがあった場合、応募済みか判定をする情報をクッキーに持たせていた場合、ユーザーがそのクッキーの情報を書き換えることで再び応募できるなど脆弱性（この場合は応募サイトの仕様）をつくことができる。

## Q11

ユーザーのテーマ設定などサーバーに送信する必要がない情報などをローカルストレージに保持する。  
とあるショッピングサイトではカートに入れている商品の情報をローカルストレージに保持していた。クッキーだと same-origin（Domain 属性や Samesite 属性によるが）へのリクエストに常にクッキーをヘッダーに含むので、余計な情報を送信したくない場合はローカルストレージを利用する。また、サーバー側でローカルストレージを操作できないので操作されたくない場合にも利用できる。

## Q12

1. 投稿内容に`<script>タグ`で JavaScript のコードを投稿する
2. XSS 対策をしていない場合、1 の内容が JavaScript として投稿内容とともに埋め込まれる
3. 1 のコードがクッキーを操作するもので且つクッキーに HttpOnly 属性が設定されていない場合、クッキーの情報を取得し、悪意のあるサイトに送信することなどができてしまう

## Quiz

以下はクッキーの仕様です。間違いがありますが、どれでしょうか。

- 一つのサイトで 30 個まで
- 一つにつき 4MB バイトまで
- サーバーにデータを自動で送信する
- 有効期限あり

## メモ

- same-origin
- cross-site
- cross-origin

https://web.dev/same-site-same-origin/
